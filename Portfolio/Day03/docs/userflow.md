# User Flow: 회의실 예약 시스템

## Meta
- 작성일: 2025-11-07
- 작성자: Portfolio Project
- 버전: 1.0

---

## 목차
1. [회의실 목록 조회 및 선택](#기능-회의실-목록-조회-및-선택)
2. [날짜/시간대 선택 (빈 시간 확인)](#기능-날짜시간대-선택-빈-시간-확인)
3. [예약 정보 입력 및 등록](#기능-예약-정보-입력-및-등록)
4. [예약 조회 (휴대폰번호 + 비밀번호)](#기능-예약-조회-휴대폰번호--비밀번호)
5. [예약 취소](#기능-예약-취소)
6. [테스트 관리자 접근](#기능-테스트-관리자-접근)
7. [어드민 회의실 관리](#기능-어드민-회의실-관리)
8. [어드민 예약 현황 조회](#기능-어드민-예약-현황-조회)

---

## 기능: 회의실 목록 조회 및 선택

### 1. 입력 (User Actions)
- **트리거**: 메인 페이지 접속 또는 "회의실 예약" 버튼 클릭
- **입력 데이터**: 없음 (조회만)

### 2. 처리 (System Logic)

**정상 플로우**:
1. 사용자가 메인 페이지 접속
2. Supabase에서 모든 회의실 데이터 조회 (이름, 위치, 수용인원)
3. 각 회의실의 현재 예약 현황 조회
4. 회의실 목록을 카드 형태로 렌더링 (즉시 예약 가능 상태 표시)
5. 수용인원별 필터링 옵션 제공

**예외 처리**:
- **DB 연결 실패** → "서비스 일시 중단. 잠시 후 다시 시도해주세요" 메시지
- **회의실 데이터 없음** → "등록된 회의실이 없습니다" 안내
- **네트워크 오류** → 로딩 상태 유지 후 재시도 옵션 제공

### 3. 출력 (User Feedback)

**성공 시**:
- **UI**: 회의실 카드 목록 표시 (이름, 위치, 수용인원, 즉시 예약 가능 상태), 필터링 옵션
- **사이드이펙트**: 페이지 방문 로그 기록, 조회 시간 기록

**실패 시**:
- **UI**: 에러 메시지와 "새로고침" 버튼
- **복구 경로**: 수동 새로고침, 메인 페이지 재방문

---

### 엣지케이스 체크리스트
- [x] **중복 데이터**: 같은 이름 회의실 구분 (ID로 구별)
- [x] **네트워크 오류**: 타임아웃 처리, 재시도 로직
- [x] **입력 검증 실패**: N/A (조회만 수행)
- [x] **권한 부족**: N/A (누구나 조회 가능)
- [x] **동시성 이슈**: 여러 사용자 동시 조회 시 성능 최적화

---

## 기능: 날짜/시간대 선택 (빈 시간 확인)

### 1. 입력 (User Actions)
- **트리거**: 회의실 카드에서 "예약하기" 버튼 클릭
- **입력 데이터**:
  - 선택한 회의실 ID (자동 전달)
  - 예약 희망 날짜 (달력에서 선택)
  - 시간대 (9시-18시 중 1시간 단위 슬롯 선택)

### 2. 처리 (System Logic)

**정상 플로우**:
1. 선택된 회의실 정보 표시
2. 달력 컴포넌트 렌더링 (오늘 이후 날짜만 선택 가능)
3. 날짜 선택 시 해당 날짜의 예약 현황 조회
4. 시간 슬롯 그리드 표시 (9시-18시, 1시간 단위)
5. 예약된 시간은 비활성화, 빈 시간은 선택 가능하게 표시
6. 시간 선택 시 "다음 단계" 버튼 활성화

**예외 처리**:
- **과거 날짜 선택** → 달력에서 비활성화, 클릭 시 "과거 날짜는 선택할 수 없습니다" 툴팁
- **예약 데이터 로딩 실패** → "예약 현황을 불러올 수 없습니다" + 새로고침 옵션
- **모든 시간대 예약됨** → "선택한 날짜는 모든 시간이 예약되었습니다. 다른 날짜를 선택해주세요"
- **동시 예약 충돌** → 실시간 업데이트로 이미 예약된 시간 즉시 비활성화

### 3. 출력 (User Feedback)

**성공 시**:
- **UI**: 선택된 회의실명, 날짜, 시간 정보 하이라이트 + "예약 정보 입력" 버튼 활성화
- **사이드이펙트**: 선택 정보 임시 저장 (세션/로컬스토리지), 페이지 이동 준비

**실패 시**:
- **UI**: 해당 오류 메시지 표시, 문제 영역 빨간 테두리 표시
- **복구 경로**: 다른 날짜 선택, 다른 회의실 선택, 이전 단계로 돌아가기

---

### 엣지케이스 체크리스트
- [x] **중복 데이터**: 실시간 예약 현황 동기화로 방지
- [x] **네트워크 오류**: "예약 현황 조회 실패" + 재시도 버튼
- [x] **입력 검증 실패**: 날짜/시간 미선택 시 진행 버튼 비활성화
- [x] **권한 부족**: N/A (누구나 조회 가능)
- [x] **동시성 이슈**: 다른 사용자가 동일 시간 예약 시 실시간 반영

---

## 기능: 예약 정보 입력 및 등록

### 1. 입력 (User Actions)
- **트리거**: 날짜/시간 선택 후 "예약 정보 입력" 버튼 클릭
- **입력 데이터**:
  - 예약자명 (필수, 2-20자)
  - 휴대폰번호 (필수, 010-XXXX-XXXX 형식)
  - 예약 목적 (필수, 10-100자)
  - 비밀번호 (필수, 4-8자 숫자)
  - 개인정보 처리 동의 (체크박스 필수)

### 2. 처리 (System Logic)

**정상 플로우**:
1. 입력 필드 검증 (형식, 길이, 필수값)
2. 휴대폰번호 중복 체크 (같은 시간대)
3. 선택한 시간대 재확인 (동시성 체크)
4. 비밀번호 해싱 처리
5. Supabase에 예약 정보 저장
6. 예약 확인 번호 생성 (BOOK-YYYYMMDD-XXXX)
7. 예약 완료 페이지로 이동

**예외 처리**:
- **필수 입력 누락** → 해당 필드 빨간 테두리 + "필수 입력 사항입니다" 메시지
- **휴대폰번호 형식 오류** → "올바른 휴대폰번호를 입력하세요 (010-XXXX-XXXX)"
- **동일 시간대 중복 예약** → "이미 예약된 시간입니다. 다른 시간을 선택해주세요"
- **DB 저장 실패** → "예약 처리 중 오류가 발생했습니다. 다시 시도해주세요"
- **개인정보 동의 미체크** → "개인정보 처리 방침에 동의해주세요"

### 3. 출력 (User Feedback)

**성공 시**:
- **UI**: 예약 완료 페이지 이동, 확인번호 + 예약 상세정보 표시, "내 예약 조회" 버튼
- **사이드이펙트**: 예약 완료 로그 기록, 임시 데이터 정리

**실패 시**:
- **UI**: 입력 폼 유지, 오류 필드 하이라이트, 구체적 에러 메시지
- **복구 경로**: 입력 수정 후 재시도, 이전 단계로 돌아가기, 메인으로 돌아가기

---

### 엣지케이스 체크리스트
- [x] **중복 데이터**: 동일 시간대 동일 휴대폰번호 예약 방지
- [x] **네트워크 오류**: "예약 처리 실패" + 재시도 버튼 + 입력 데이터 보존
- [x] **입력 검증 실패**: 실시간 검증 + 제출 시 재검증
- [x] **권한 부족**: N/A (누구나 예약 가능)
- [x] **동시성 이슈**: 예약 시점에 시간대 재확인 + 락 메커니즘

---

## 기능: 예약 조회 (휴대폰번호 + 비밀번호)

### 1. 입력 (User Actions)
- **트리거**: 메인 페이지에서 "내 예약 조회" 버튼 클릭
- **입력 데이터**:
  - 휴대폰번호 (필수, 010-XXXX-XXXX 형식)
  - 비밀번호 (필수, 4-8자 숫자)

### 2. 처리 (System Logic)

**정상 플로우**:
1. 입력 필드 형식 검증
2. 휴대폰번호로 DB에서 예약 내역 조회
3. 비밀번호 해시 비교 검증
4. 해당 사용자의 모든 예약 내역 조회 (과거/현재/미래)
5. 예약 상태별 정렬 (진행 예정 → 완료 → 취소)
6. 예약 목록 페이지 렌더링

**예외 처리**:
- **휴대폰번호 미존재** → "등록된 예약 내역이 없습니다"
- **비밀번호 불일치** → "비밀번호가 일치하지 않습니다" (3회 실패 시 5분 잠금)
- **입력 형식 오류** → "올바른 형식으로 입력해주세요"
- **DB 조회 실패** → "조회 중 오류가 발생했습니다. 잠시 후 다시 시도해주세요"
- **연속 실패 시도** → "보안을 위해 5분 후 다시 시도해주세요"

### 3. 출력 (User Feedback)

**성공 시**:
- **UI**: 예약 목록 표시 (확인번호, 회의실명, 날짜/시간, 상태), 각 예약별 "상세보기" "취소하기" 버튼
- **사이드이펙트**: 조회 로그 기록, 마지막 조회 시간 업데이트

**실패 시**:
- **UI**: 로그인 폼 유지, 에러 메시지 표시, 실패 횟수 안내
- **복구 경로**: 정보 재입력, 비밀번호 찾기 기능(향후 구현 예정), 새 예약하기

---

### 엣지케이스 체크리스트
- [x] **중복 데이터**: N/A (조회만 수행)
- [x] **네트워크 오류**: "조회 실패" 메시지 + 재시도 버튼
- [x] **입력 검증 실패**: 실시간 형식 검증 + 빈 필드 방지
- [x] **권한 부족**: 비밀번호 불일치 시 접근 차단
- [x] **동시성 이슈**: N/A (읽기 전용 작업)

---

## 기능: 예약 취소

### 1. 입력 (User Actions)
- **트리거**: 예약 조회 결과에서 "취소하기" 버튼 클릭
- **입력 데이터**:
  - 예약 ID (자동 전달)
  - 취소 확인 (확인 팝업에서 "예" 클릭)
  - 취소 사유 (선택, 드롭다운: 일정 변경/회의 취소/기타)

### 2. 처리 (System Logic)

**정상 플로우**:
1. 예약 상태 확인 (취소 가능한 상태인지)
2. 예약 시간 확인 (취소 가능 시점 검증 - 1시간 전까지)
3. 취소 확인 팝업 표시
4. 사용자 확인 시 DB에서 예약 상태를 '취소'로 업데이트
5. 취소 시간 및 사유 기록
6. 성공 메시지 표시 후 예약 목록 새로고침

**예외 처리**:
- **이미 취소된 예약** → "이미 취소된 예약입니다"
- **과거 예약** → "완료된 예약은 취소할 수 없습니다"
- **취소 불가 시점** → "예약 시작 1시간 전까지만 취소 가능합니다"
- **DB 업데이트 실패** → "취소 처리 중 오류가 발생했습니다. 다시 시도해주세요"
- **권한 없음** → "본인의 예약만 취소할 수 있습니다"

### 3. 출력 (User Feedback)

**성공 시**:
- **UI**: "예약이 취소되었습니다" 성공 메시지, 예약 목록에서 해당 예약 상태 '취소됨'으로 표시
- **사이드이펙트**: 취소 로그 기록, 해당 시간대를 다시 예약 가능 상태로 변경

**실패 시**:
- **UI**: 에러 메시지 토스트, 예약 목록 상태 유지
- **복구 경로**: 새로고침 후 재시도, 고객센터 문의 안내

---

### 엣지케이스 체크리스트
- [x] **중복 데이터**: 동일 예약 중복 취소 방지
- [x] **네트워크 오류**: 취소 처리 실패 시 롤백 + 재시도 옵션
- [x] **입력 검증 실패**: 취소 불가능한 예약은 버튼 비활성화
- [x] **권한 부족**: 타인 예약 취소 시도 차단
- [x] **동시성 이슈**: 동일 예약 동시 취소 시도 시 첫 번째만 처리

---

## 기능: 테스트 관리자 접근

### 1. 입력 (User Actions)
- **트리거**: URL 직접 접근 (`/admin`) 또는 메인에서 "관리자 모드" 버튼
- **입력 데이터**:
  - 테스트 ID: `admin` (고정)
  - 테스트 비밀번호: `1234` (고정, 간단)

### 2. 처리 (System Logic)

**정상 플로우**:
1. 간단한 로그인 폼 표시
2. 하드코딩된 테스트 계정(`admin` / `1234`) 비교
3. 성공 시 관리자 대시보드 접근
4. 로컬스토리지에 간단한 플래그 저장

**예외 처리**:
- **잘못된 정보** → "테스트 계정: admin / 1234" 힌트 표시
- **빈 필드** → 기본값 자동 입력 옵션 제공

### 3. 출력 (User Feedback)

**성공 시**:
- **UI**: 관리자 대시보드, "테스트 관리자 모드" 표시
- **사이드이펙트**: 단순 접근 기록

**실패 시**:
- **UI**: 힌트 메시지 표시, "자동 입력" 버튼 제공
- **복구 경로**: 자동 입력 또는 일반 모드 돌아가기

---

### 엣지케이스 체크리스트
- [x] **중복 데이터**: N/A (단일 테스트 계정)
- [x] **네트워크 오류**: N/A (클라이언트 사이드 검증)
- [x] **입력 검증 실패**: 자동 입력 옵션으로 해결
- [x] **권한 부족**: 힌트 제공으로 접근성 향상
- [x] **동시성 이슈**: N/A (테스트용 단순 접근)

---

## 기능: 어드민 회의실 관리

### 1. 입력 (User Actions)
- **트리거**: 테스트 관리자 로그인 후 "회의실 관리" 메뉴 클릭
- **입력 데이터** (회의실 추가/수정 시):
  - 회의실명 (필수, 2-30자)
  - 위치 (필수, 2-50자)
  - 수용인원 (필수, 1-100명)
  - 운영시간 (기본: 9시-18시, 변경 가능)

### 2. 처리 (System Logic)

**정상 플로우**:
1. 현재 등록된 회의실 목록 조회 및 표시
2. "회의실 추가" / "수정" / "삭제" 버튼 제공
3. 추가/수정 시 입력 폼 모달 표시
4. 입력 데이터 검증 후 Supabase DB 업데이트
5. 성공 시 목록 새로고침 및 성공 메시지
6. 삭제 시 예약 존재 여부 확인 후 처리 (예약 데이터는 보존)

**예외 처리**:
- **중복 회의실명** → "동일한 이름의 회의실이 존재합니다"
- **예약 중인 회의실 삭제** → "예약이 있는 회의실은 삭제할 수 없습니다"
- **필수 필드 누락** → 해당 필드 하이라이트 + "필수 입력사항입니다"
- **DB 업데이트 실패** → "처리 중 오류가 발생했습니다" + 재시도 옵션
- **수용인원 범위 초과** → "수용인원은 1-100명 사이로 입력하세요"

### 3. 출력 (User Feedback)

**성공 시**:
- **UI**: 회의실 목록 업데이트, "저장되었습니다" 토스트 메시지, 모달 닫기
- **사이드이펙트**: 관리 작업 로그 기록, 일반 사용자 화면에 실시간 반영

**실패 시**:
- **UI**: 모달 유지, 오류 필드 빨간 테두리, 구체적 에러 메시지
- **복구 경로**: 입력 수정 후 재시도, 취소 후 목록으로 돌아가기

---

### 엣지케이스 체크리스트
- [x] **중복 데이터**: 회의실명 중복 방지
- [x] **네트워크 오류**: 저장 실패 시 입력 데이터 보존 + 재시도
- [x] **입력 검증 실패**: 실시간 검증 + 제출 시 재검증
- [x] **권한 부족**: 테스트 관리자만 접근 가능
- [x] **동시성 이슈**: 여러 관리자 동시 수정 시 충돌 방지

---

## 기능: 어드민 예약 현황 조회

### 1. 입력 (User Actions)
- **트리거**: 테스트 관리자 로그인 후 "예약 현황" 메뉴 클릭
- **입력 데이터**:
  - 조회 날짜 범위 (기본: 오늘부터 7일)
  - 회의실 필터 (전체 또는 특정 회의실)
  - 예약 상태 필터 (전체/예약됨/취소됨)

### 2. 처리 (System Logic)

**정상 플로우**:
1. 관리자 대시보드에서 예약 현황 탭 표시
2. 필터 조건에 따라 예약 데이터 조회
3. 날짜별, 회의실별로 그룹화된 예약 현황 표시
4. 각 예약의 상세 정보 (예약자, 시간, 상태) 테이블 렌더링
5. 통계 정보 표시 (총 예약 수, 이용률, 취소율)
6. 엑셀 다운로드 기능 제공

**예외 처리**:
- **데이터 없음** → "선택한 기간에 예약 내역이 없습니다"
- **DB 조회 실패** → "데이터를 불러올 수 없습니다" + 새로고침 버튼
- **필터 조건 오류** → 기본값으로 리셋 + "조건을 다시 설정해주세요"
- **대용량 데이터** → 페이징 처리 + "데이터가 많아 시간이 걸릴 수 있습니다"

### 3. 출력 (User Feedback)

**성공 시**:
- **UI**: 예약 현황 테이블, 통계 차트, 필터링 옵션, 다운로드 버튼
- **사이드이펙트**: 조회 로그 기록, 캐시 데이터 저장

**실패 시**:
- **UI**: 에러 메시지 + 빈 테이블 상태, 새로고침/필터 리셋 버튼
- **복구 경로**: 필터 조건 변경, 날짜 범위 축소, 전체 새로고침

---

### 엣지케이스 체크리스트
- [x] **중복 데이터**: N/A (조회만 수행)
- [x] **네트워크 오류**: 조회 실패 시 캐시 데이터 표시 + 재시도
- [x] **입력 검증 실패**: 잘못된 날짜 범위 자동 수정
- [x] **권한 부족**: 테스트 관리자만 접근 가능
- [x] **동시성 이슈**: N/A (읽기 전용)

---

## 의존성 & 연계

- **회의실 목록 조회** → **날짜/시간대 선택**: 회의실 선택 후 시간 선택으로 이동
- **날짜/시간대 선택** → **예약 정보 입력**: 시간 선택 후 정보 입력으로 이동
- **예약 정보 입력** → **예약 조회**: 예약 완료 후 "내 예약 조회" 버튼으로 연결
- **예약 조회** → **예약 취소**: 예약 목록에서 취소 기능 접근
- **테스트 관리자 접근**은 **어드민 회의실 관리** 및 **어드민 예약 현황 조회**의 전제 조건
- **어드민 회의실 관리**의 변경사항은 **회의실 목록 조회**에 실시간 반영

---

## 오픈 이슈

- [ ] [2025-11-07] 결정 필요: 예약 수정 기능 vs 취소 후 재예약 (현재: 취소 후 재예약)
- [ ] [2025-11-07] 결정 필요: 알림 기능 구현 여부 (이메일/SMS) (현재: 제외)
- [ ] [2025-11-07] 결정 필요: 예약 가능 기간 제한 (현재: 제한 없음)
- [ ] [2025-11-07] 검토 필요: 동시 접속자 수에 따른 성능 최적화 방안