# Userflow: 콘서트 예약 플랫폼

## Userflow 1: 콘서트 목록 조회

### Input (입력)
- 사용자가 앱 접속
- URL: `/` (홈페이지)

### Processing (처리)
1. 서버/로컬 스토리지에서 콘서트 목록 데이터 로드
2. 각 콘서트의 예약 가능 여부 계산
3. 콘서트 카드 리스트 렌더링

### Output (출력)
**화면 구성**:
- 헤더: "콘서트 예약", "예약 조회" 메뉴
- 콘서트 카드 그리드:
  ```
  [콘서트 이미지]
  제목: {concert.title}
  아티스트: {concert.artist}
  날짜: {concert.date}
  장소: {concert.venue}
  가격: {minPrice}원 ~ {maxPrice}원
  상태: [예약 가능] or [매진]
  ```

**사용자 액션**:
- 콘서트 카드 클릭 → Userflow 2로 이동

**Edge Cases**:
- 콘서트 목록이 없는 경우: "등록된 콘서트가 없습니다" 메시지 표시
- 로딩 중: 스켈레톤 UI 또는 로딩 스피너 표시
- 에러 발생: "콘서트를 불러오는데 실패했습니다" 에러 메시지

---

## Userflow 2: 콘서트 상세 조회

### Input (입력)
- 콘서트 카드 클릭
- URL: `/concerts/{concertId}`
- Parameter: `concertId` (선택한 콘서트 ID)

### Processing (처리)
1. `concertId`로 콘서트 상세 정보 조회
2. 해당 콘서트의 좌석 정보 조회
3. 예약 가능한 좌석 수 계산
4. 좌석 등급별 가격 정보 조회

### Output (출력)
**화면 구성**:
```
[뒤로가기 버튼]

[콘서트 상세 이미지]

제목: {concert.title}
아티스트: {concert.artist}
날짜: {concert.date}
시간: {concert.time}
장소: {concert.venue}
러닝타임: {concert.runningTime}분

[출연진 정보]
{concert.performers}

[가격 정보]
VIP석: 150,000원
R석: 100,000원
S석: 70,000원
A석: 50,000원

[공연 설명]
{concert.description}

예약 가능 좌석: {availableSeats}석 / {totalSeats}석

[좌석 선택하기 버튼]
```

**사용자 액션**:
- "뒤로가기" 버튼 클릭 → Userflow 1로 돌아가기
- "좌석 선택하기" 버튼 클릭 → Userflow 3으로 이동

**Edge Cases**:
- 콘서트를 찾을 수 없는 경우: "존재하지 않는 콘서트입니다" 에러 메시지
- 예약 가능한 좌석이 0개: "좌석 선택하기" 버튼 비활성화 + "매진" 표시
- 로딩 중: 스켈레톤 UI 표시

---

## Userflow 3: 좌석 선택

### Input (입력)
- "좌석 선택하기" 버튼 클릭
- URL: `/concerts/{concertId}/seats`
- Parameter: `concertId`

### Processing (처리)
1. 콘서트의 모든 좌석 정보 조회
2. 좌석 배치도 렌더링:
   - 15행 x 10열 = 150개 좌석
   - 각 좌석의 상태 표시:
     - 예약 가능 (isBooked: false) → 녹색
     - 예약 완료 (isBooked: true) → 빨간색
     - 선택됨 (사용자가 선택) → 노란색
3. 좌석 등급별 색상 구분 표시

### Output (출력)
**화면 구성**:
```
[뒤로가기 버튼]

              [STAGE]

[좌석 배치도]
    1  2  3  4  5  6  7  8  9  10
1  [V][V][V][V][V][V][V][V][V][V]  VIP
2  [V][V][V][V][V][V][V][V][V][V]  VIP
3  [R][R][R][R][R][R][R][R][R][R]  R석
4  [R][R][R][R][R][R][R][R][R][R]  R석
5  [R][R][R][R][R][R][R][R][R][R]  R석
6  [S][S][S][S][S][S][S][S][S][S]  S석
7  [S][S][S][S][S][S][S][S][S][S]  S석
...
15 [A][A][A][A][A][A][A][A][A][A]  A석

[범례]
🟢 선택 가능  🔴 예약 완료  🟡 선택됨

[선택된 좌석 정보]
- 1행 5번 (VIP) - 150,000원
- 1행 6번 (VIP) - 150,000원

선택한 좌석: 2개
총 금액: 300,000원

[예약하기 버튼]
```

**좌석 배치 규칙**:
- **1-2열**: VIP석 (150,000원)
- **3-5열**: R석 (100,000원)
- **6-10열**: S석 (70,000원)
- **11-15열**: A석 (50,000원)

**사용자 액션**:
- 예약 가능한 좌석 클릭 → 좌석 선택 (노란색으로 변경)
- 선택된 좌석 다시 클릭 → 선택 취소 (원래 색으로 복귀)
- 예약 완료된 좌석 클릭 → 아무 동작 없음 (클릭 불가)
- "예약하기" 버튼 클릭 → Userflow 4로 이동

**비즈니스 규칙**:
- 최소 1개, 최대 4개 좌석만 선택 가능
- 4개 선택된 상태에서 다른 좌석 클릭 시: "최대 4개까지만 선택할 수 있습니다" 알림

**Edge Cases**:
- 좌석을 선택하지 않고 "예약하기" 클릭: "좌석을 선택해주세요" 알림
- 5개 이상 선택 시도: "최대 4개까지 선택 가능합니다" 알림
- 이미 예약된 좌석 클릭: "이미 예약된 좌석입니다" 툴팁 표시
- 좌석 로딩 중: 스켈레톤 UI 표시

---

## Userflow 4: 예약 정보 입력

### Input (입력)
- "예약하기" 버튼 클릭
- URL: `/concerts/{concertId}/booking`
- State: 선택된 좌석 정보 (seatIds[], totalAmount)

### Processing (처리)
1. 선택된 좌석 정보를 상태에서 가져옴
2. 예약 정보 입력 폼 렌더링
3. 실시간 입력 검증

### Output (출력)
**화면 구성**:
```
[뒤로가기 버튼]

예약 정보 입력

[선택한 좌석 정보 요약]
콘서트: {concert.title}
날짜: {concert.date}
좌석:
- 1행 5번 (VIP) - 150,000원
- 1행 6번 (VIP) - 150,000원

총 결제 금액: 300,000원

━━━━━━━━━━━━━━━━━━

[입력 폼]
이름 *
[___________________]
(한글, 영문 2-20자)

전화번호 *
[___________________]
(010-XXXX-XXXX)

이메일 *
[___________________]
(example@email.com)

생년월일 (선택)
[___________________]
(YYYY-MM-DD)

[결제하기 버튼]
```

**입력 필드 검증 규칙**:

| 필드 | 필수 | 형식 | 검증 규칙 |
|------|------|------|-----------|
| 이름 | ✅ | 텍스트 | 2-20자, 한글/영문만 허용 |
| 전화번호 | ✅ | 텍스트 | 010-XXXX-XXXX, 숫자만 |
| 이메일 | ✅ | 이메일 | 표준 이메일 형식 |
| 생년월일 | ❌ | 날짜 | YYYY-MM-DD, 과거 날짜만 |

**실시간 검증**:
- 각 필드 blur 시 검증 수행
- 에러가 있으면 필드 아래 빨간색 에러 메시지 표시

**사용자 액션**:
- "뒤로가기" 버튼 클릭 → Userflow 3으로 돌아가기 (입력 데이터 유지 여부 확인)
- "결제하기" 버튼 클릭 → 전체 검증 후 Userflow 5로 이동

**Edge Cases**:
- 필수 필드가 비어있는 상태에서 "결제하기" 클릭:
  - 첫 번째 에러 필드로 포커스 이동
  - "필수 항목을 입력해주세요" 알림
- 형식이 잘못된 경우:
  - 이름: "2-20자의 한글 또는 영문만 입력해주세요"
  - 전화번호: "010-XXXX-XXXX 형식으로 입력해주세요"
  - 이메일: "올바른 이메일 형식이 아닙니다"
  - 생년월일: "YYYY-MM-DD 형식으로 입력해주세요"
- 좌석 정보가 없는 경우: 좌석 선택 화면으로 리다이렉트

**검증 예시**:
```
이름: "홍길동" ✅
이름: "홍" ❌ (2자 미만)
이름: "Hong Gil Dong123" ❌ (특수문자, 숫자 포함)

전화번호: "010-1234-5678" ✅
전화번호: "01012345678" ❌ (형식 불일치)
전화번호: "02-1234-5678" ❌ (010으로 시작하지 않음)

이메일: "test@example.com" ✅
이메일: "test@example" ❌ (도메인 없음)
이메일: "test.com" ❌ (@ 없음)

생년월일: "1990-01-01" ✅
생년월일: "2030-01-01" ❌ (미래 날짜)
생년월일: "90-01-01" ❌ (형식 불일치)
```

---

## Userflow 5: 예약 완료

### Input (입력)
- "결제하기" 버튼 클릭 (검증 통과)
- Data:
  - `concertId`
  - `seatIds[]` (선택된 좌석 ID 배열)
  - `customerName`
  - `customerPhone`
  - `customerEmail`
  - `customerBirthdate` (선택)

### Processing (처리)
1. 예약 데이터 생성:
   ```typescript
   {
     id: generateBookingId(), // "BK-20250116-XXXX" 형식
     concertId,
     seatIds,
     customerName,
     customerPhone,
     customerEmail,
     customerBirthdate,
     totalAmount: 계산된 총액,
     createdAt: new Date(),
     status: 'confirmed'
   }
   ```
2. 선택된 좌석들의 `isBooked` 상태를 `true`로 변경
3. 예약 정보를 로컬 스토리지/서버에 저장
4. 예약 완료 화면으로 리다이렉트

### Output (출력)
**화면 구성**:
```
✅ 예약이 완료되었습니다!

━━━━━━━━━━━━━━━━━━

예약 번호
BK-20250116-0001

━━━━━━━━━━━━━━━━━━

[예약 정보]

콘서트 정보
제목: {concert.title}
날짜: {concert.date}
장소: {concert.venue}

좌석 정보
- 1행 5번 (VIP) - 150,000원
- 1행 6번 (VIP) - 150,000원

예약자 정보
이름: {customerName}
전화번호: {customerPhone}
이메일: {customerEmail}

총 결제 금액
300,000원

━━━━━━━━━━━━━━━━━━

[예약 조회] 버튼
[홈으로] 버튼
```

**사용자 액션**:
- "예약 조회" 버튼 클릭 → Userflow 6으로 이동
- "홈으로" 버튼 클릭 → Userflow 1로 이동

**Edge Cases**:
- 예약 처리 중 에러 발생:
  - "예약 처리 중 오류가 발생했습니다. 다시 시도해주세요" 에러 메시지
  - 좌석 선택 화면으로 리다이렉트
- 이미 예약된 좌석인 경우 (동시 예약 충돌):
  - "선택하신 좌석이 이미 예약되었습니다. 다시 선택해주세요" 알림
  - 좌석 선택 화면으로 리다이렉트

---

## Userflow 6: 예약 조회

### Input (입력)
- 헤더 메뉴에서 "예약 조회" 클릭
- 또는 예약 완료 후 "예약 조회" 버튼 클릭
- URL: `/bookings`

### Processing (처리)
1. 로컬 스토리지/서버에서 모든 예약 내역 조회
2. 예약 날짜 기준 내림차순 정렬 (최신 예약이 위)
3. 각 예약의 콘서트 정보와 좌석 정보 조인

### Output (출력)
**화면 구성** (예약 내역이 있는 경우):
```
나의 예약 내역

━━━━━━━━━━━━━━━━━━

[예약 카드 1]
예약 번호: BK-20250116-0001
콘서트: 아이유 콘서트 2025
날짜: 2025-02-14 19:00
장소: 올림픽공원 체조경기장
좌석: 1행 5번(VIP), 1행 6번(VIP)
예약자: 홍길동
금액: 300,000원
상태: [예약 완료]

[상세보기] 버튼

━━━━━━━━━━━━━━━━━━

[예약 카드 2]
예약 번호: BK-20250115-0023
콘서트: BTS 월드투어
날짜: 2025-03-20 18:00
장소: 잠실 종합운동장
좌석: 3행 4번(R석)
예약자: 홍길동
금액: 100,000원
상태: [예약 완료]

[상세보기] 버튼

━━━━━━━━━━━━━━━━━━

총 {bookings.length}건의 예약
```

**화면 구성** (예약 내역이 없는 경우):
```
나의 예약 내역

━━━━━━━━━━━━━━━━━━

📋 예약 내역이 없습니다

아직 예약한 콘서트가 없습니다.
지금 바로 콘서트를 예약해보세요!

[콘서트 둘러보기] 버튼
```

**사용자 액션**:
- "상세보기" 버튼 클릭 → 해당 예약의 상세 정보 모달/페이지 표시
- "콘서트 둘러보기" 버튼 클릭 (예약 없을 때) → Userflow 1로 이동

**예약 상세 정보 모달**:
```
━━━━━━━━━━━━━━━━━━
예약 상세 정보
━━━━━━━━━━━━━━━━━━

예약 번호: BK-20250116-0001
예약 일시: 2025-01-16 14:23

[콘서트 정보]
제목: 아이유 콘서트 2025
날짜: 2025-02-14 19:00
장소: 올림픽공원 체조경기장

[좌석 정보]
- 1행 5번 (VIP) - 150,000원
- 1행 6번 (VIP) - 150,000원

[예약자 정보]
이름: 홍길동
전화번호: 010-1234-5678
이메일: hong@example.com
생년월일: 1990-01-01

[결제 정보]
총 금액: 300,000원
상태: 예약 완료

[닫기] 버튼
```

**Edge Cases**:
- 예약 목록 로딩 중: 스켈레톤 UI 표시
- 예약 조회 실패: "예약 내역을 불러오는데 실패했습니다" 에러 메시지

---

## 전체 사용자 여정 플로우 다이어그램

```
[홈 - 콘서트 목록]
      ↓
[콘서트 상세]
      ↓
[좌석 선택]
  (최소 1개, 최대 4개)
      ↓
[예약 정보 입력]
  (이름, 전화번호, 이메일, 생년월일)
      ↓
[예약 완료]
  (예약 번호 발급)
      ↓
    ↙   ↘
[예약 조회]  [홈으로]
```

---

## 상태 전이 (State Transitions)

### 좌석 상태 전이
```
예약 가능 (isBooked: false, 녹색)
    ↓ [사용자가 클릭]
선택됨 (isBooked: false, selected: true, 노란색)
    ↓ [다시 클릭]
예약 가능 (isBooked: false, 녹색)
    ↓ [예약 완료]
예약 완료 (isBooked: true, 빨간색)
```

### 예약 프로세스 상태
```
1. 콘서트 탐색 (browsing)
    ↓
2. 콘서트 선택 (viewing)
    ↓
3. 좌석 선택 중 (selecting)
    ↓
4. 정보 입력 중 (filling)
    ↓
5. 예약 처리 중 (processing)
    ↓
6. 예약 완료 (confirmed)
```

---

## 데이터 흐름 요약

### Flow 1-2: 콘서트 조회
```
User → [View Concert List] → Load Concerts → Display
User → [Click Concert] → Load Concert Detail → Display
```

### Flow 3: 좌석 선택
```
User → [Click Seat] → Toggle Selection → Update UI
User → [Click Book] → Validate (1-4 seats) → Navigate
```

### Flow 4-5: 예약 처리
```
User → [Submit Form] → Validate Inputs → Create Booking → Update Seats → Display Confirmation
```

### Flow 6: 예약 조회
```
User → [View Bookings] → Load All Bookings → Display List
User → [Click Detail] → Show Booking Detail
```

---

## 에러 처리 전략

### 사용자 입력 에러
- **즉시 피드백**: 필드 blur 시 검증
- **명확한 메시지**: 구체적인 에러 이유 설명
- **복구 가이드**: 올바른 형식 예시 제공

### 시스템 에러
- **로딩 실패**: "다시 시도" 버튼 제공
- **네트워크 에러**: "인터넷 연결을 확인해주세요"
- **동시성 충돌**: 좌석 선택 화면으로 돌아가기

### 비즈니스 규칙 위반
- **좌석 수 초과**: "최대 4개까지만 선택 가능합니다"
- **매진된 좌석**: "이미 예약된 좌석입니다"
- **필수 정보 누락**: 해당 필드로 포커스 이동

---

**문서 버전**: 1.0
**작성일**: 2025-01-16
**다음 단계**: Tech Stack 선정
